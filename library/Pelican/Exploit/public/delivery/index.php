<?php
	/** Fichier de configuration */
	include_once('config.php');
	require_once("delivery.ini.php");
	
    if (!Pelican::$config["SHOW_DEBUG"]) {
        exit();
    }
    
	if (!$_SESSION[APP]["user"]["id"]) {
		//echo("Veuillez vous identifier en Back Office");
		//exit;
	}
	 
	if (!is_array($_DELIVERY["HOST"][$_SERVER["HTTP_HOST"]])) {
		$_DELIVERY["HOST"][$_SERVER["HTTP_HOST"]] = array($_DELIVERY["HOST"][$_SERVER["HTTP_HOST"]]);
	}
	 
	$from = $_SERVER["HTTP_HOST"];
	$to = $_DELIVERY["HOST"][$_SERVER["HTTP_HOST"]][0];
	 
	$oConnection = Pelican_Db::getInstance();
	$tables = $oConnection->getDbInfo('tables');
?>
<html>
<head>
<link href="style.css" media="screen" rel="stylesheet" type="text/css" />
<script>
var timestamp = <?=mktime()?>;
var i = 0;
function getData(table) {
	i++;
	document.getElementById("source").src = "getData.php?param=" + table + "&timestamp=" + (timestamp+i);
}
function getDb(table) {
	i++;
	document.getElementById("source").src = "getDb.php?param=" + table + "&timestamp=" + (timestamp+i);
}
</script>
</head>
<body>
<div id="title">migration de <?=$from?> vers <?=$to?></div>
<div id="content">
<div class="button">
Data
<br /><? echo Pelican_Html::span(array("class"=>"labelbutton"),"Livraisons"); ?><button onclick="getData('');">Données</button><button onclick="getDb('');">Structures</button>
<br />
<br />
<?php
	foreach ($tables as $table) {
		if (!substr_count($table, "\$")) {
			echo Pelican_Html::span(array("class" => "labelbutton"), $table)
			.Pelican_Html::button(array(onclick => "getData('".str_replace((Pelican::$config['FW_PREFIXE_TABLE']), "", $table)."');"), "Données")
			.Pelican_Html::button(array(onclick => "getDb('".str_replace((Pelican::$config['FW_PREFIXE_TABLE']), "", $table)."');"), "Structure");
		}
	}
?>
</div>
<div id="iframe">
<iframe src="" id="source" name="source"></iframe>
</div>
</div>
</body>
</html>