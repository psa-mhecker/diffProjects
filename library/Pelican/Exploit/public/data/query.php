<?php
	/** Génération de requêtes update
	*
	* @package Pelican
	* @subpackage Db
	*/

	/** Fichier de configuration */
	include_once('config.php');

	if (!$_SESSION[APP]["user"]["id"]) {
		echo("Veuillez vous identifier en Back Office");
		exit;
	}

	if ($_GET["table"]) {
		getValues($_GET["table"], $_GET["action"], $_GET["field"], $_GET["where"], $_GET["order"]);
	}

	function getValues($table, $action, $field = "", $where = "", $order = "") {

		

		$oConnection = Pelican_Db::getInstance();

		set_time_limit(300);

		echo("--DEBUT ".$table." ".$action."<br>");

		echo("SET DEFINE OFF;<br>");

		$oConnection->allowBind = false;

		if (!$field) {
			$field = "*";
		} else {
			$field = $field;
		}
		$sql = "SELECT ".$field." FROM ".$table.($where?" where ".str_replace("\\'", "'", $where):"").($order?" ORDER BY ".$order:"");
		$ZONE = $oConnection->queryTab($sql);
		foreach ($ZONE as Pelican_Db::$values) {
			$result = $oConnection->updateTable($action, $table, "", array("COLTEST", "LIGTEST", "LARTEST"), "", true);
			if ($result) {
			echo(str_replace("'''", "''", str_replace("\n", "", str_replace(";###", ";<br />", str_replace("'NULL'", "NULL", htmlentities(implode(";###", $result)))).";<br>")));
		}
		}
		echo("--FIN ".$table." ".$action."<br>");
	}
?>